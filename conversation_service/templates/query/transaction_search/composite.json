{
  "template_name": "transaction_search_composite",
  "description": "Recherche de transactions avec critères multiples",
  "target_intention": "TRANSACTION_SEARCH.composite",
  "parameters": {
    "user_id": "{{user_id}}",
    "query": "{{text_query}}",
    "filters": {
      "date": "<<date_range>>",
      "amount_abs": "<<amount_range>>",
      "transaction_type": "{{transaction_type}}",
      "merchant_name": "<<merchant_name>>",
      "category_name": "{{category_name}}",
      "operation_type": "{{operation_type}}"
    },
    "sort": [
      {"date": {"order": "desc"}},
      {"amount_abs": {"order": "desc"}}
    ],
    "page_size": "{{page_size}}"
  },
  "parameter_mappings": {
    "user_id": {
      "required": true,
      "type": "integer",
      "source": "context.user_id"
    },
    "text_query": {
      "required": false,
      "type": "string",
      "source": "entities.query"
    },
    "date_range": {
      "required": false,
      "type": "object",
      "source": "entities.date_range"
    },
    "amount_range": {
      "required": false,
      "type": "object",
      "source": "entities.montant"
    },
    "transaction_type": {
      "required": false,
      "type": "string",
      "source": "entities.transaction_type",
      "allowed_values": ["credit", "debit", "all"]
    },
    "merchant_name": {
      "required": false,
      "type": "merchant_name",
      "source": "entities.merchant"
    },
    "category_name": {
      "required": false,
      "type": "string",
      "source": "entities.categories"
    },
    "operation_type": {
      "required": false,
      "type": "string",
      "source": "entities.operation_type",
      "allowed_values": ["Carte", "Chèque", "Prélèvement", "Virement"]
    },
    "page_size": {
      "required": false,
      "type": "integer",
      "source": "context.page_size",
      "default": 50,
      "min": 1,
      "max": 200
    }
  },
  "filter_cleanup": {
    "remove_null_values": true,
    "remove_empty_objects": true
  },
  "optimizations": {
    "cache_duration": "10m",
    "elasticsearch_routing": "user_id"
  }
}