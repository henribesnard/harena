{
  "template_name": "transaction_search_filter",
  "description": "Template pour recherche de transactions avec filtre marchand",
  "target_intention": "TRANSACTION_SEARCH.filter",
  "parameters": {
    "user_id": "{{user_id}}",
    "query": "{{merchant_query}}",
    "filters": {
      "merchant_name": "{{merchant_name}}",
      "transaction_type": "{{transaction_type}}",
      "operation_type": "{{operation_type}}",
      "amount_abs": "{% if montant %}{{to_es_amount_filter(montant)}}{% else %}null{% endif %}",
      "date": "{{ date_range if date_range else null }}",
      "category_name": "{{ categories if categories else null }}"
    },
    "sort": [
      {"date": {"order": "desc"}}
    ],
    "page_size": 50
  },
  "parameter_mappings": {
    "user_id": {
      "required": true,
      "type": "integer",
      "source": "context.user_id"
    },
    "merchant_query": {
      "required": false,
      "type": "string",
      "source": "entities.merchant",
      "default": ""
    },
    "merchant_name": {
      "required": false,
      "type": "array",
      "source": "entities.merchants",
      "description": "Liste des marchands (prioritaire sur merchant)"
    },
    "montant": {
      "required": false,
      "type": "object",
      "source": "entities.montant",
      "validation": {
        "numeric_values": true,
        "positive_only": true
      }
    },
    "transaction_type": {
      "required": false,
      "type": "string",
      "source": "entities.transaction_type",
      "allowed_values": ["debit", "credit"],
      "default": ""
    },
    "operation_type": {
      "required": false,
      "type": "string",
      "source": "entities.operation_type",
      "allowed_values": ["direct_debit", "transfer", "card_payment", "check", "cash_withdrawal", "standing_order"],
      "default": ""
    },
    "date_range": {
      "required": false,
      "type": "object",
      "source": "entities.date_range",
      "validation": {
        "keys": ["gte", "lte"],
        "date_format": "ISO8601"
      }
    },
    "categories": {
      "required": false,
      "type": "array",
      "source": "entities.categories",
      "description": "Liste des catégories à inclure dans la recherche"
    }
  },
  "filter_cleanup": {
    "remove_null_values": true,
    "remove_empty_objects": true
  },
  "optimizations": {
    "cache_duration": "30m",
    "elasticsearch_routing": "user_id"
  }
}