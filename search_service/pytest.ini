[tool:pytest]
# Configuration pytest pour Search Service

# Répertoires de tests
testpaths = tests

# Patterns de découverte des tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Markers personnalisés
markers =
    unit: Tests unitaires (rapides, pas de dépendances externes)
    integration: Tests d'intégration (avec dépendances externes)
    security: Tests de sécurité
    performance: Tests de performance
    slow: Tests lents (> 5 secondes)
    elasticsearch: Tests nécessitant Elasticsearch
    api: Tests API FastAPI
    cache: Tests du système de cache
    core: Tests des composants core

# Options par défaut
addopts = 
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --disable-warnings
    --color=yes
    --durations=10
    -ra

# Filtres par défaut (ne lance que les tests unit par défaut)
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning:elasticsearch.*
    ignore::UserWarning:urllib3.*

# Configuration asyncio
asyncio_mode = auto

# Répertoire de sortie des rapports
junit_family = xunit2

# Configuration couverture de code (si pytest-cov installé)
# --cov=search_service
# --cov-report=term-missing
# --cov-report=html:htmlcov
# --cov-report=xml:coverage.xml
# --cov-fail-under=70

# Timeout pour les tests (si pytest-timeout installé)
# timeout = 30

# Variables d'environnement pour les tests
env = 
    TESTING = true
    LOG_LEVEL = WARNING
    PYTHONPATH = .

# Logging
log_cli = false
log_cli_level = WARNING
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Découverte des tests
norecursedirs = .git .tox dist build *.egg __pycache__ .pytest_cache

# Configuration pour les tests lents
# minversion = 6.0
# required_plugins = pytest-asyncio

# Configuration xdist (si pytest-xdist installé)
# -n auto pour parallélisation automatique